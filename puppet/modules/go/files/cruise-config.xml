<?xml version="1.0" encoding="utf-8"?>
<cruise xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="cruise-config.xsd" schemaVersion="53">
  <pipelines group="AwsDevOpsGroup">
    <pipeline name="AwsTwitterFeedProject" isLocked="true">
      <materials>
        <git url="https://github.com/nigelfds/aws-twitter-feed" />
      </materials>
      <stage name="CommitBuild">
        <jobs>
          <job name="package">
            <tasks>
              <exec command="./go" args="package" />
            </tasks>
            <artifacts>
              <artifact src="aws-twitter-feed-0.0.1.noarch.rpm" dest="rpms" />
            </artifacts>
          </job>
        </jobs>
      </stage>
    </pipeline>
    <pipeline name="ConfigurationMasterProject" isLocked="true">
      <environmentvariables>
        <variable name="SETTINGS_FILE">
          <value>/var/boot/puppet/settings.yaml</value>
        </variable>
      </environmentvariables>
      <materials>
        <git url="https://github.com/nigelfds/configuration-master" />
      </materials>
      <stage name="CommitBuild">
        <jobs>
          <job name="package">
            <tasks>
              <exec command="./go" args="package:puppet" />
            </tasks>
            <artifacts>
              <artifact src="build/boot.tar.gz" dest="build" />
            </artifacts>
          </job>
        </jobs>
      </stage>
    </pipeline>
    <pipeline name="SystemIntegration" isLocked="true">
      <materials>
        <pipeline pipelineName="AwsTwitterFeedProject" stageName="CommitBuild" materialName="upstreamArtifactApp" />
        <pipeline pipelineName="ConfigurationMasterProject" stageName="CommitBuild" materialName="upstreamArtifactConfiguration" />
        <git url="https://github.com/nigelfds/configuration-master" />
      </materials>
      <stage name="CommitBuild">
        <jobs>
          <job name="package">
            <tasks>
              <exec command="/bin/echo">
                <arg>'hello'</arg>
                <runif status="passed" />
              </exec>
            </tasks>
          </job>
        </jobs>
      </stage>
    </pipeline>
  </pipelines>
</cruise>

